var default_text="";if(coachId){if(if_reply=="True"){default_text="继续回复"}else{default_text="请点评一下学员的项目吧, 您可以指出学生在项目中比较出彩或需要改进的地方"}}else{if(if_reply=="True"){default_text="继续回复"}else{default_text="请描述一下你制作项目的细节吧"}}var ue=createUE("bdeditor");ue.ready(function(){ue.setContent('<p style="color: #7a7a7a;font-size: 14px;font-family: "Microsoft Yahei";">'+default_text+"</p>")});ue.addListener("focus",function(){if(ue.getContentTxt()==default_text){ue.setContent("")}});function createUE(name){return UE.getEditor(name,{toolbars:[["simpleupload"]],autoClearinitialContent:true,autoFloatEnabled:false,wordCount:false,elementPathEnabled:false,initialFrameHeight:140,initialFrameWidth:728,initialContent:default_text,autoClearEmptyNode:true,wordCount:false,autoHeightEnabled:false,initialStyle:"p{color: #7a7a7a;font-size: 14px;line-height:1em;font-family: Microsoft Yahei;}img{max-width:100%;}"})}upload();function upload(){var addFile=$("#add-file"),fileList={},timestamp;function FileName(path){var File=path.replace(/.*(\/|\\)/,"");return File}function saveName(){addFile.change(function(event){var name=$(event.target).val();$(event.target).attr("data-name",FileName(name))})}saveName();addFile.fileupload({url:"/lps4/coach_project_upload/",dataType:"json",dropZone:null,autoUpload:true,add:function(e,data){var uploadErrors=[];var acceptFileTypes=/^(zip|rar|ppt|doc|xls|docx|xlsx|pptx|pdf|txt)$/i;var filesize=data.originalFiles[0]["size"]/(1024*1024);Ntype=data.originalFiles[0]["name"].split(".");Ntype=Ntype[Ntype.length-1];if(!acceptFileTypes.test(Ntype)){layer.msg("暂时仅支持：doc、docx、ppt、pptx、xls、xlsx、pdf、txt格式文件的上传，其余格式请压缩为rar、zip格式上传");uploadErrors.push("Not an accepted file type")}if(parseInt(filesize)>20){layer.msg("文件超过20M大小");uploadErrors.push("Filesize is too big")}if(uploadErrors.length==0){data.submit()}},start:function(e,data){timestamp=e.timeStamp;var name=$(e.target).attr("data-name"),Ext=name.split("."),Ext=Ext[Ext.length-1],sourceLists=$("#source-lists"),htmlTemp=$('<div id="'+timestamp+'"><div class="dt '+Ext+'">'+name+'</div><div class="dd"><div class="progressbar"><span class="line"><i class="progress-line" style="width: 50px;"></i></span><span class="percent font16">50%</span></div><span class="success textR">导入成功</span><span class="fail textR">导入失败，<a class="reset">点击重试</a></span><a class="remove"></a></div></div>');sourceLists.prepend(htmlTemp)},progress:function(e,data){var progress=parseInt(data.loaded/data.total*90,10);$(".progress-line").css("width",progress+"%");$(".percent").text(progress+"%")},failed:function(e,data){if(data.result.success){$(".fail").show();$("#source-lists").on("click",".reset",function(){$("#source-lists").html("");addFile.trigger("click")})}},done:function(e,data){if(data.result.success){$(e.target).attr("data-name","");$(".progress-line").css("width","100%");$(".percent").text("100%");$(".progressbar").hide();$(".success").show();fileList[timestamp]={"file_url":data.result.data.url,"file_type":data.result.data.type,"file_name":data.result.data.name}}}});$("#source-lists").on("click",".remove",function(){$(this).parent().parent().remove();var id=$(this).parent().parent().attr("id");delete fileList[id]});var bindSubmit;$(".project-submit").bind("click",bindSubmit=function(){var strContentcreate=ue.getContent(),projectCon=$("#project-con"),dataJson={"content":strContentcreate,"fileList":JSON.stringify(fileList)},_this=$(this);_this.unbind("click",bindSubmit);if(strContentcreate==""||ue.getContentTxt()==default_text){layer.alert("内容不能为空",{skin:"layui-layer-molv",closeBtn:0})}else{if(coachId){var post_url="/lps4/teacher_coach_project/"+coachId+"/"}else{var post_url="/lps4/student_coach_project/"+classId+"_"+stageTaskId+"_"+itemId+"/"}$.ajax({url:post_url,type:"POST",data:dataJson,success:function(data){var htmlTemp=$('<div class="item"><div class="left"><a href="/u/'+data.data.user_id+'/"><img src="'+data.data.head+'" alt=""><i class="'+data.data.user_type+'"></i></a><p class="font18 textC bold">'+data.data.nick_name+'</p></div><div class="right"><div class="font16 color66 marginB40">'+data.data.comment+"</p></div>"+data.data.files_div+'<p class="return-time font16 color66">'+data.data.create_date+"</p></div></div>");if(data.success){projectCon.append(htmlTemp);ue.setContent('<p style="color: #7a7a7a;font-size: 14px;font-family: "Microsoft Yahei";">继续回复</p>');$("#source-lists").html("");fileList={};if($(".grade_float>.info")){$(".grade_float>.info").hide()}}else{layer.alert(data.message,{skin:"layui-layer-molv",closeBtn:0})}}})}(function(that){setTimeout(function(){$(that).bind("click",bindSubmit)},3000)})(_this)})};