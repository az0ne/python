/*! LPS4.0 2016-10-21
*/
function isEnd(){1==video.ended&&($(document).trigger("mouseup"),video.currentTime=0,isFullScreen()&&exitFullScreen(),controlBar.detach(),$(".videoStopMeg").show())}function showBigPlayButton(){"True"!=$("#ad").val()||"True"==$("#is_paid").val()||0==video.currentTime?$(".vip").show():$(".ordinary").show()}function pop_pay(){var e=$("#just_pay");e.hasClass("in")||e.modal({show:!0,keyboard:!1,backdrop:"static"})}function get_current_lesson_index(){return parseInt($(".lesson li .selected").text())}function startPause(){video.paused?(video.play(),$(".loading-video").hide(),$(".big-play-button").hide(),0==$(".control-bar").length&&zvideoWrap.append(controlBar),$(".videoStopMeg").hide(),controlText.text("Pause").attr("title","Pause").removeClass("playing").addClass("paused"),zvideoWrap.off("mousemove").on("mousemove",function(){controlBar.fadeIn(500),isFullScreen()&&videoHeader.fadeIn(500)}),$(window).moveStopEvent(function(){controlBar.fadeOut(500),isFullScreen()&&videoHeader.fadeOut(500)})):(video.pause(),showBigPlayButton(),controlText.text("Play").attr("title","Play").removeClass("paused").addClass("playing"),Ad.show())}function updateVolume(){var e,t,i,n,o;e=arguments[0]?arguments[0]:null,t=arguments[1]?arguments[1]:null,i=$(".volume-bar"),n=i.width(),o=video.volume*n,e?o=e-i.offset().left:t&&(o+=n*t);var s=o/n;s>1&&(s=1),0>s&&(s=0),o=n*s,video.muted&&toggleMute(),percent=o/n,0==percent?$(".volume span").css({"background-position-y":"-263px"}):percent>0&&.3>percent?$(".volume span").css({"background-position-y":"-289px"}):percent>.3&&.6>percent||.3==percent?$(".volume span").css({"background-position-y":"-315px"}):(percent>.6||.6==percent)&&$(".volume span").css({"background-position-y":"-342px"}),video.volume=s;var a=parseInt(100*(o/n));$(".volume-level").css("width",o+"px"),$(".volume-prompt").text(a+"%"),$(".volume-prompt").show(),setTimeout("$('.volume-prompt').hide()",1500)}function toggleMute(){switch(video.muted=!video.muted,video.muted&&(volume_size=volumeLevel.css("width"),position_y=Volume.children("span").css("background-position-y")),video.muted){case!0:volumeLevel.css("width","0"),Volume.children("span").css({"background-position-y":"-263px"});break;case!1:volumeLevel.css({width:volume_size}),Volume.children("span").css({"background-position-y":position_y})}return!1}function setTime(e){0==e?video.currentTime=e:video.currentTime+=e}function isFullScreen(){var e,t,i,n,o;return e=document,t=e.fullscreenElement,i=e.mozFullScreenElement,n=e.webkitFullscreenElement,o=e.msFullscreenElement,t||i||n||o}function toggleFullScreen(){isFullScreen()?exitFullScreen():fullScreen()}function fullScreen(){_isFull=!0,zvideoWrap.css({width:"100%",height:"100%",position:"fixed",top:"0",left:"0","z-index":"1000001"}),zvideo.requestFullscreen?zvideo.requestFullscreen():zvideo.webkitRequestFullscreen?zvideo.webkitRequestFullscreen():zvideo.mozRequestFullScreen?zvideo.mozRequestFullScreen():zvideo.msRequestFullscreen&&zvideo.msRequestFullscreen(),$(".full-screen").addClass("quit-screen"),videoWrap.after(videoHeaderDom),$(".view-port .Big").addClass("on").siblings().removeClass("on")}function exitFullScreen(){_isFull=!1;var e=document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.oRequestFullscreen?e.oCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen(),$(".zvideo").removeAttr("style"),$("#myVideo").removeAttr("style"),$(".full-screen").removeClass("quit-screen"),videoHeader.detach()}function changeTime(e){var t,i,n;return t=Math.floor(e/3600),i=Math.floor(e/60),n=Math.floor(e%60),n=10>n?"0"+n:n,i=10>i?"0"+i:i,t=10>t?"0"+t:t,(t>0?t+":":"")+i+":"+n}function update(){var e,t,i;e=video.currentTime,t=video.duration,i=e/t,$(".timeBar").css("width",100*i+"%");var n=$(".video-header");!isFullScreen()&&n.length?(videoHeader.detach(),_isFull=!1,videoWrap.width("100%").css({margin:"0"}).height("100%")):isFullScreen()&&!n.length&&(videoWrap.after(videoHeaderDom),_isFull=!0),isEnd()}function updatebar(e){var t,i,n,o;t=$(".progressBar"),i=video.duration,t.length>0?(n=e-t.offset().left,o=100*n/t.width()):o=100,o>100&&(o=100),0>o&&(o=0),$(".timeBar").css("width",o+"%"),0==video.ended&&(video.currentTime=i*o/100)}var volumeDrag,inVolumeControl,VolumeControl,_isFull,videoHeaderDom,timeDrag,OFF1=!0,_move=!1,zvideoWrap=$(".zvideo"),zvideo=zvideoWrap[0],videoWrap=$("video"),video=videoWrap[0],controlText=$(".play-control .control-text"),controlBar=$(".control-bar"),videoHeader=$(".video-header"),Volume=$(".volume"),volumeControl=$(".volume-control"),volumeHandle=$(".volume-handle"),volumeLevel=$(".volume-level");outFull=$(".out-full a"),Ad=$(".ad"),fullWidth="1024px",fullHeight="768px",headTitle1=$(".video_part_lists li.liH a").find(".col_l").text(),headTitle2=$(".zyleve1 li.liH a").attr("title"),video.volume=.4,controlBar.mousemove(function(e){var e=e||event;e.stopPropagation()}),videoHeader.mousemove(function(e){var e=e||event;e.stopPropagation()}),$(".loading-video, .play-control").on("click",function(){var e=get_current_lesson_index();"False"==$thisUser?login_popup("请先登录"):(1==OFF1&&($studentClass.length>0?(videoWrap.attr("src",$vipUrl),videoWrap.load()):1==e||2==e?(videoWrap.attr("src",$lessonUrl),videoWrap.load()):(""!=$isPaid||"True"!=$needPay)&&(videoWrap.attr("src",$lessonUrl),videoWrap.load())),OFF1=!1)}),$("video, .big-play-button, .loading-video, .play-control").on("click",function(){var e=get_current_lesson_index();"True"==$thisUser&&1==e||2==e?startPause():""==$isPaid&&"True"==$needPay?pop_pay():startPause()}),Ad.on("click",function(e){var e=e||event;e.stopPropagation()}),$(".ad span").on("click",function(){$(this).parent().hide()});var currentDomClassName="";$(document).off("click").on("click",function(e){event=e||window.event,currentDomClassName=e.target}),$(document).on("keydown",function(e){e=e||window.event;var t=e.which||e.keyCode;$(currentDomClassName).parents(".zvideo").length>0&&32==t&&(startPause(),zvideoWrap.mousemove(),e.preventDefault())}),$(".volume-bar,.volume-dot,.volume-level,.volume-size").off("click").on("click",function(e){updateVolume(e.pageX)}).mousedown(function(e){_move=!0,updateVolume(e.pageX)}),$(document).mousemove(function(e){_move&&updateVolume(e.pageX)}).mouseup(function(){_move=!1}),$(document).keyup(function(e){e=e||window.event;var t=e.which||e.keyCode;38==t&&updateVolume(null,.1)}),$(document).keyup(function(e){e=e||window.event;var t=e.which||e.keyCode;40==t&&updateVolume(null,-.1)}),$(".progressBar").mousemove(function(e){var t=$(".progressBar"),i=e.pageX-t.offset().left,n=$videoLength,o=n*i/t.width();$(".hover-time").text(changeTime(o)).css({left:i-34+"px"}),i>=0&&t.width()>=i?$(".hover-time").show():$(".hover-time").hide()}),$(".progressBar").mouseout(function(){$(".hover-time").hide()}),$(".volume span").click(function(){toggleMute()}),$(document).keyup(function(e){e=e||window.event;var t=e.which||e.keyCode;39==t&&setTime(10)}),$(document).keyup(function(e){e=e||window.event;var t=e.which||e.keyCode;37==t&&setTime(-10)}),$(".view-port a").click(function(){var e,t;e=$(this).text().split("%")[0]/100,$(this).addClass("on").siblings().removeClass("on"),fullWidth=$(window).innerWidth(),fullHeight=$(window).innerHeight(),t=(1-e)/2*fullHeight+"px "+(1-e)/2*fullWidth+"px",videoWrap.width(fullWidth*e).height(fullHeight*e).css({margin:t})}),function(e){e.fn.moveStopEvent=function(t){return this.each(function(){var i,n=0,o=0,s=0,a=0,r=!1,l=this,c=function(){i=setInterval(function(){video.paused?clearInterval(i):(n==s&&o==a&&(clearInterval(i),r=!1,t&&t.call(l)),n=s,o=a)},1e3)};e(this).mousemove(function(e){s=e.pageX,a=e.pageY,!r&&c(),r=!0}).mouseout(function(){clearInterval(i),r=!1})})}}(jQuery),_isFull=!1,videoHeader.find(".video-name").text(headTitle1||headTitle2),videoHeaderDom=videoHeader.show().detach(),$(".full-screen").on("click",function(){toggleFullScreen()}),$(document).keyup(function(e){e=e||window.event;var t=e.which||e.keyCode;27==t&&(exitFullScreen(),zvideoWrap.mousemove())}),outFull.on("click",function(){exitFullScreen()}),$(".duration").text(changeTime($videoLength)),videoWrap.on("timeupdate",function(){$(".current").text(changeTime(video.currentTime))}),window.setInterval(function(){update()},250),video.addEventListener("progress",function(){if(4==video.readyState){var e=100*(video.buffered.end(0)/video.duration);$(".bufferBar").css("width",e+"%")}},!1),timeDrag=!1,$(".progressBar").mousedown(function(e){timeDrag=!0,updatebar(e.pageX)}),$(document).mouseup(function(e){timeDrag&&(timeDrag=!1,updatebar(e.pageX))}),$(document).mousemove(function(e){timeDrag&&updatebar(e.pageX)}),$(".play-rate-menu ul li").click(function(){var e=$(this).text().split("x")[0];$(this).addClass("on").siblings().removeClass("on"),video.playbackRate=e,$(this).parents(".play-rate-menu").siblings("span").text(e+"x")});