/*! LPS4.0 2016-10-31
*/
function format_number(e){return 10>parseInt(e)?"0"+e:e}function ajaxContentFun(e,t,n){for(var a,i,o,s=$(".onLineInfo li"),r=$(".calenDar li"),l=[],c=[],d=[],p=[],u=[],f=[],m=[],h=0,g=s.length;g>h;h++)if(l[h]=$(s[h]).find(".time .start").text(),c[h]=$(s[h]).find(".time .end").text(),p[h]=l[h]+"-"+c[h],u.length<r.length)for(var _=0,v=r.length;v>_;_++){var y=e.eq(_).find("span").text();i=y.replace(/[^0-9]/gi,"-"),i=i.substring(0,i.length-1),6>=i.length&&(i=t+"-"+i);var k=[];$(i.split("-")).each(function(e,t){k.push(format_number(t))}),i=k[0]+"-"+k[1]+"-"+k[2],u[_]=i}var b,x,w,I,T=$(".lineCreate"),C=$(".lineRecall");if($.ajax({type:"POST",url:"/home/t/ajax_onevone_add_list/",data:{timelist:p,datelist:u},dataType:"json",success:function(e){for(var t=0,o=s.length;o>t;t++){a=$(s[t]).find(".state span"),x=p[t],w=a.eq(t).attr("id");for(var r=0;7>r;r++){b=u[r],I=a.eq(r).attr("id"),n||a.eq(r).hasClass("selected")&&(selectedSpanArry.push(i+" "+x),selectedIdArry.push(I));var l=e.data[x][b];switch(l.status){case 0:T.find(a).eq(r).html('<a href="javascript:;"></a>'),C.find(a).eq(r).html("");break;case 1:T.find(a).eq(r).html("已结束"),C.find(a).eq(r).html("");break;case 2:T.find(a).eq(r).html("已创建"),C.find(a).eq(r).attr("id",l.id).html('<a href="javascript:;"></a>');break;case 3:T.find(a).eq(r).html("已创建"),C.find(a).eq(r).html("")}}}}}),n){s.find(".state .selected").removeClass("selected");for(var j=0,A=selectedSpanArry.length;A>j;j++){d[j]=selectedSpanArry[j].split(" ");for(var h=0,g=s.length;g>h;h++){a=$(s[h]).find(".state span"),f[h]=$(s[h]).find(".time .start").text(),m[h]=$(s[h]).find(".time .end").text();for(var _=0;7>_;_++){var y=e.eq(_).find("span").text();o=y.replace(/[^0-9]/gi,"-"),o=o.substring(0,o.length-1),6>=o.length&&(o=t+"-"+o),o==d[j][0]&&f[h]+"-"+m[h]==d[j][1]&&$(s[h]).find(".state span").eq(_).addClass("selected")}}}}}function addTimeArry(e,t){var n;n=conversionDate(e,t),selectedSpanArry.push(n[0]+" "+n[1]+"-"+n[2]),selectedIdArry.push(n[3])}function delTimeArry(e,t){var n,a,i;a=conversionDate(e,t);for(var o=Date.parse(new Date(a[0]+" "+a[1]+"-"+a[2]))/1e3,s=[],r=0,l=selectedSpanArry.length;l>r;r++)s[r]=Date.parse(new Date(selectedSpanArry[r]))/1e3;(s.indexOf(o)||0==s.indexOf(o))&&(n=s.indexOf(o),selectedSpanArry.splice(n,1)),(selectedIdArry.indexOf(a[3])||0==selectedIdArry.indexOf(a[3]))&&(i=selectedIdArry.indexOf(a[3]),selectedIdArry.splice(i,1))}function conversionDate(e,t){var n,a,i,o,s=(new Date).getFullYear(),r=$(".onLineInfo li"),l=$(".onlineBox .calenDar li"),c=l.eq(e).find("span").text();return i=c.replace(/[^0-9]/gi,"-"),i=i.substring(0,i.length-1),6>=i.length&&(i=s+"-"+i),n=r.eq(t).find(".time .start").text(),a=r.eq(t).find(".time .end").text(),$(".lineRecall").length&&(o=r.eq(t).find(".state span").eq(e).attr("id")),[i,n,a,o]}var selectedSpanArry=[],selectedIdArry=[];$(function(){$(".teacherICO").on("mouseover",function(){layer.tips($(this).attr("title"),$(this),{tips:[1,"#333"]})}),ScrollCalendar({dateLi:".onlineBox .calenDar li",arrowLeft:".onlineBox .arrL",arrowRight:".onlineBox .arrR"}),$(".onLineInfo .state").on({click:function(){var e=$(this).parent().index(),t=$(this).parents("li").index();$(this).parent().hasClass("selected")?($(this).parent().removeClass("selected"),delTimeArry(e,t),console.log(selectedSpanArry)):($(this).parent().addClass("selected"),addTimeArry(e,t),console.log(selectedSpanArry))}},"a"),$(".onlineBox .refer .empty").on("click",function(){for(var e=$(".onLineInfo .state span.selected"),t=0,n=e.length;n>t;t++){var a=e.eq(t).index(),i=e.eq(t).parents("li").index();delTimeArry(a,i)}$(".onLineInfo .state span").removeClass("selected")}),$(".onlineBox .refer .confirm.created").on("click",function(){var e=[],t=[],n=[],a=[],i=[];if(0!=selectedSpanArry.length){for(var o=0,s=selectedSpanArry.length;s>o;o++)t[o]=selectedSpanArry[o].split(" "),n=t[o][1].split("-"),a[o]=t[o][0]+" "+n[0],i[o]=t[o][0]+" "+n[1],e.push(a[o]+"--"+i[o]);$.ajax({type:"POST",url:"/home/t/ajax_create_onevone/",data:{meeting_list:JSON.stringify(e)},dataType:"json",success:function(e){e.success&&window.location.reload()}}),console.log(e)}}),$(".onlineBox .refer .confirm.cancel").on("click",function(){0!=selectedIdArry.length&&($.ajax({type:"POST",url:"/home/t/ajax_del_onevone/",data:{meeting_list:JSON.stringify(selectedIdArry)},dataType:"json",success:function(e){e.success&&window.location.reload()}}),console.log(selectedIdArry))})});