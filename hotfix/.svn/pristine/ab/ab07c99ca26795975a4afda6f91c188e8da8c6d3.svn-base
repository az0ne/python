/*! LPS4.0 2016-09-12
*/
var init=function(){function e(){var e=$(".praise-btn"),t=!0;e.on("click",function(){"True"==thisUser?($(this).addClass("good"),t&&($.ajax({type:"POST",url:"/common/ajax/like/article",data:{article_id:articleId},success:d,complete:function(){e.addClass("disabled_praise")}}),t=!1)):login_popup()})}function t(e){return UE.getEditor(e,{toolbars:[["insertcode","simpleupload","emotion"]],autoClearinitialContent:!0,autoFloatEnabled:!1,wordCount:!0,maximumWords:1e3,elementPathEnabled:!1,initialFrameHeight:94})}function i(e){var t=$(e).parent().parent().parent().parent();return t}function s(e){var t=$(e).attr("data-id"),i=$(e).attr("data-parent-id");return{id:t,parent_id:i}}function a(e){var t=$(e).parent().parent();return t}function n(e){var t=i(e),n=s(t);return 0!=parseInt(n.parent_id)?a(t):t}function o(){$(".reviews_answer").on({click:function(){if("True"==thisUser){var e=$(this).parent().siblings(".divUEContent");if(""==$(e).html()){$(".reviews_answer a").text("回复"),$(".divUEContent").html("");var t=$("#divUE").html();$(e).html(t),$(this).text("收起")}else $(e).html(""),$(this).text("回复")}else login_popup();$(".submit_reviews").on({click:function(){r(this)}},"button")}},"a")}function l(e,t){var i=$(e).children(".col_r").children(".divUEContent");i.after(t)}function r(e){var t=h.getContent(),i=h.body.innerHTML.replace(/<[^>]+>/g,"").replace(/&nbsp;/g,"").replace(/​/,"").trim(),a=n(e),r=s(a).id,c=$(".divUEContent .submit_reviews");""!=t&&"说点什么吧..."==h.getContentTxt()?(c.find("span").css("left",0).text("至少15个字符"),setTimeout(function(){c.find("span").css("left","-100px").text("")},2e3),h.setContent("")):15>i.length?(c.find("span").css("left",0).text("至少15个字符"),setTimeout(function(){c.find("span").css("left","-100px").text("")},2e3)):$.ajax({type:"POST",url:"/common/ajax/add/discuss",data:{object_type:"ARTICLE",object_id:articleId,parent_id:r,comment:t},success:function(e){if(e.success){var i="";i+='<div parent="parent_0" class="item child" data-id="'+e.id+'" data-parent-id="'+e.parent_id+'">',i+='<div class="col_l"><a href="'+$(".sign_reviews a").attr("href")+'" target="_blank"><img src="'+$(".sign_reviews img").attr("src")+'" alt="'+$(".sign_reviews .nike_name").text()+'"></a></div>',i+='<div class="col_r" style="width: 710px;">',i+='<p><span class="nike_name">'+$(".sign_reviews .nike_name").text()+'</span><span class="date_time">刚刚</span></p>',i+="<p>"+t+"</p>",i+='<p class="reviews_answer"><a href="javascript:void(0);">回复</a></p>',i+='<div class="divUEContent"></div>',i+="</div>",i+="</div>",l(a,i),o(),$(".reviews_answer a").text("回复"),$(".divUEContent").html("")}else c.find("span").css("left",0).text("提交失败"),setTimeout(function(){c.find("span").css("left","-100px").text("")},2e3)}})}function c(e){var t=$(".submit_reviews");if(e.success){var i="",s=u.getContent();u.setContent(""),t.find("span").css("left",0).text("提交成功"),setTimeout(function(){t.find("span").css("left","-100px").text("")},2e3),i+='<div parent="parent_0" class="item" data-id="'+e.id+'" data-parent-id="'+e.parent_id+'">',i+='<div class="col_l"><a href="'+$(".sign_reviews a").attr("href")+'" target="_blank"><img src="'+$(".sign_reviews img").attr("src")+'" alt="'+$(".sign_reviews .nike_name").text()+'"></a></div>',i+='<div class="col_r" style="width: 710px;">',i+='<p><span class="nike_name">'+$(".sign_reviews .nike_name").text()+'</span><span class="date_time">刚刚</span></p>',i+="<p>"+s+"</p>",i+='<p class="reviews_answer"><a href="javascript:void(0);">回复</a></p>',i+='<div class="divUEContent"></div>',i+="</div>",i+="</div>",$(".reviews_lists").prepend(i),o()}else t.find("span").css("left",0).text("提交失败"),setTimeout(function(){t.find("span").css("left","-100px").text("")},2e3)}function d(e){var t=$(".praise-btn span i");t.text(e.like_num)}function p(e){var t,i="",s=$(".reviews_lists");if($(".reviews_num").text(e.discuss_total+"条评论"),e=e.discuss,e.length>0){for(var a=0;e.length>a;++a)if(t=e[a].id,0==e[a].parent_id){i+='<div id = "'+e[a].id+'" class="item" data-id="'+e[a].id+'" data-parent-id="0">',i+='<div class="col_l"><a href="/u/'+e[a].user_id+'" target="_blank"><img src="'+MEDIAURL+e[a].head+'" alt="'+e[a].nick_name+'"></a></div>',i+='<div class="col_r" style="width: 710px;">',i+='<p><span class="nike_name">'+e[a].nick_name+'</span><span class="date_time">'+e[a].date+"</span></p>",i+="<p>"+e[a].content+"</p>",i+='<p class="reviews_answer"><a href="javascript:void(0);">回复</a></p>',i+='<div class="divUEContent"></div>';for(var n=0;e.length>n;++n)e[n].parent_id==t&&(i+='<div class="item child" data-id="'+e[n].id+'" data-parent-id="'+t+'">',i+='<div class="col_l"><a href="/u/'+e[n].user_id+'" target="_blank"><img src="'+MEDIAURL+e[n].head+'" alt="'+e[n].nick_name+'"></a></div>',i+='<div class="col_r" style="width: 640px;">',i+='<p><span class="nike_name">'+e[n].nick_name+'</span><span class="date_time">'+e[n].date+"</span></p>",i+="<p>"+e[n].content+"</p>",i+='<p class="reviews_answer"><a href="javascript:void(0);">回复</a></p>',i+='<div class="divUEContent"></div>',i+="</div>",i+="</div>");i+="</div>",i+="</div>"}s.append(i),o()}}var u,h;"True"==thisUser&&(u=t("reviews_ueditor"),h=t("reviews_ueditor_small"),u.ready(function(){u.setContent('<p style="color: #999999;font-size: 14px;">说点什么吧...</p>')}),h.ready(function(){h.setContent('<p style="color: #999999;font-size: 14px;">说点什么吧...</p>')}),u.addListener("focus",function(){"说点什么吧..."==u.getContentTxt()&&u.setContent("")}),h.addListener("focus",function(){"说点什么吧..."==h.getContentTxt()&&h.setContent("")})),e(),$(".not_sign a").on("click",function(){login_popup()}),$.ajax({type:"GET",url:"/common/ajax/get/discuss",data:{object_type:"ARTICLE",object_id:articleId},success:p}),$(".submit_reviews").on({click:function(){var e=u.getContent(),t=$(".submit_reviews"),i=u.body.innerHTML.replace(/<[^>]+>/g,"").replace(/&nbsp;/g,"").replace(/​/,"").trim();""!=e&&"说点什么吧..."==u.getContentTxt()?(t.find("span").css("left",0).text("至少15个字符"),setTimeout(function(){t.find("span").css("left","-100px").text("")},2e3),u.setContent("")):15>i.length?(t.find("span").css("left",0).text("至少15个字符"),setTimeout(function(){t.find("span").css("left","-100px").text("")},2e3)):$.ajax({type:"POST",url:"/common/ajax/add/discuss",data:{object_type:"ARTICLE",object_id:articleId,parent_id:0,comment:e},success:c}),$(".reviews_answer a").text("回复"),$(".divUEContent").html("")}},"button")};init();