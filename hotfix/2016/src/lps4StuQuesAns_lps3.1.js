/*! LPS4.0 2016-09-28
*/
$(function(){function e(){$(".main-center").css("min-height",$(window).height()-252)}function t(){return"True"==$(".topRight").attr("login")}function a(){var e=$(".lps4_stu_ques_ans .interact .like");e.unbind(),e.each(function(){$(this).click(function(e){if(!t())return topRightLogin(),!1;e.stopPropagation();var a=$(this),o=a.attr("data-discuss-id");$.ajax({url:"/home/s/ajax_praise/",method:"POST",dataType:"json",data:{problem_id:o},success:function(e){if(e.success){var t=e.data.action,o=e.data.praise_count;"mark"==t?(a.html(o),a.addClass("parised")):"cancel"==t&&(a.html(o),a.removeClass("parised"))}else if(401==e.code)return l("登录状态已过期！"),!1}})})})}function o(){$("#main>div.cur .list>ul>li").click(function(){var e=$(this).attr("discuss_id");window.location.href=window.location+"?p_id="+e})}function n(){c=[$(".toUserCenter"),$(".interact"),$(".objectHref"),$(".answer .img"),$(".answerToUserCenter")];for(var e=0;c.length>e;e++)c[e].on("click",function(e){e.stopPropagation()})}function i(){var e=$(window).scrollTop()+$(window).height()>$(document).height()-100;e&&r(!1)}function s(){for(var e=$("#main div.cur .list").length,t=0;e>t;t++)u=$("#main>div.cur .list").eq(t).children("ul").children("li"),u.wookmark({align:"left",autoResize:!0,container:$("#main div.cur .list"),offset:20,itemWidth:420},t)}function r(e){var t=$(".tab-nav li.select a").attr("url"),r=$("#main>div.cur .list>ul>li:last").attr("discuss_id"),l=$(".personalInterlocutionTeaState>span.aH").index(),c=[];r&&c.push("end_id="+r),l&&c.push("status="+l);var d=c.join("&");$.ajax({url:t+"?"+d,dataType:"html",beforeSend:function(){$(document).off("scroll")},success:function(t){1==e?($("#main>div.cur").html(""),$("#main>div.cur .list>ul").html(t)):$("#main>div.cur .list>ul").append(t),s(),a(),o(),n(),a()},complete:function(){$(document).on("scroll",i)}})}var l,c,d,u;e(),$.ajaxSetup({cache:!0}),d=null,u=null,a(),o(),n();var m=$(".personalInterlocutionTeaState>span.aH").index();d=[],$(".personalInterlocutionTeaState>span").each(function(){d.push(m)}),$(".personalInterlocutionTeaState span").click(function(){$(this).addClass("aH").siblings().removeClass("aH"),d[$(".tab-nav li.select").index()]=$(this).index(),$(".lps4_stu_ques_ans .content>div.cur").empty(),r(!0)}),$(".tab-nav li").on("click",function(){$(this).addClass("select").siblings().removeClass("select"),$(".lps4_stu_ques_ans .content>div").eq($(this).index()).addClass("cur").siblings().removeClass("cur"),$(".personalInterlocutionTeaState>span").eq(d[$(this).index()]).addClass("aH").siblings().removeClass("aH"),s(),o()}),$(document).scroll(i),$(window).resize(function(){s(),e()}),s()});