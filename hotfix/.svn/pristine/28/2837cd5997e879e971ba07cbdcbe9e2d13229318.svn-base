/*! LPS4.0 2016-11-11
*/
function getFileUrl(e){var t="";return navigator.userAgent.indexOf("MSIE")>=1?t=document.getElementById(e).value:navigator.userAgent.indexOf("Firefox")>0?t=window.URL.createObjectURL(document.getElementById(e).files.item(0)):navigator.userAgent.indexOf("Chrome")>0&&(t=window.URL.createObjectURL(document.getElementById(e).files.item(0))),t}function getImageWidth(e,t){var n=new Image;return n.src=e,n.complete?t(n.width,n.height):n.onload=function(){t(n.width,n.height)},n}function updatePreview(e){if(parseInt(e.w)>0){var t=xsize/e.w,n=ysize/e.h;$(".cuttPictureBoxR img").css({width:Math.round(t*boundx)+"px",height:Math.round(n*boundy)+"px",marginLeft:"-"+Math.round(t*e.x)+"px",marginTop:"-"+Math.round(n*e.y)+"px"})}}function updateCoords(e){$("#x").val(e.x),$("#y").val(e.y),$("#w").val(e.w),$("#h").val(e.h)}function sendsms(e){return $.ajax({type:"POST",url:"/home/settings/bind_mobile/sendsms/",data:{mobile:$("#newPhone .pcsBasicTableTxt").val(),type:"verifyMobile",geetest_challenge:$("#newPhone .geetest_challenge").attr("value"),geetest_validate:$("#newPhone .geetest_validate").attr("value"),geetest_seccode:$("#newPhone .geetest_seccode").attr("value")},dataType:"json",beforeSend:function(){e.css("pointer-events","none")},success:function(e){e.success?($("#newPhone2").modal("show"),PhoneValue=$("#newPhone .pcsBasicTableTxt").val()):($("#newPhone .megError").html(e.message).slideDown(),captchaPhone.refresh())},complete:function(){e.css("pointer-events","auto")}})}function setIn(e,t,n){setIn_num--,e.html(setIn_num),0>=setIn_num&&(setIn_num=t||setIn_num,n.call(this),clearInterval(setInObj))}function onceSend(){var e=$(this);e.html("重发验证码(<span>60</span>s)").css("pointer-events","none"),$.ajax({type:"POST",url:"/home/settings/bind_mobile/sendsms/",data:{mobile:PhoneValue,retry:!0},dataType:"json",beforeSend:function(){},success:function(t){if(t.success){var n=$("#newPhone2 .fg > a");$("#newPhone2 .pm").html("手机短信验证码已发送，请查收！").slideDown(),e.removeAttr("style").addClass("smsend"),setInObj=setInterval(_foo($("#newPhone2 .fg > a>span"),60,function(){n.html("重发验证码").removeClass("smsend"),n.unbind().click(onceSend),e.css("pointer-events","auto")}),1e3)}else $("#newPhone2 .pm").html(t.message).slideDown()},complete:function(){}})}function _foo(e,t,n){return setIn_num=t||setIn_num,clearInterval(setInObj),function(){setIn(e,t,n)}}function upImg(e,t,n,a,s,i,o){var r=$(this);$.ajax({type:"POST",url:"/home/settings/avatar/save/",data:{img_url:e,picwidth:t,picheight:n,width:a,height:s,left:i,top:o},dataType:"json",beforeSend:function(){r.css("pointer-events","none")},success:function(e){e.success?location.reload():alert(e.message)},complete:function(){r.css("pointer-events","auto")}})}function change_photo0(){$.ajax({type:"POST",url:"/home/settings/avatar/random/",dataType:"json",success:function(e){e.success?$(".pcsBasicTableOne .img img,.personalCTop .img img,.top_user .ai img,.zy_userDiv .d1 img").attr("src",e.data.avatar):alert(e.message)}})}function selectCity(){var e=$(this);$.ajax({type:"POST",url:"/home/base/citylist/"+e.val()+"/",dataType:"json",success:function(e){if(e.success){var t=$(".pcsBasicTable .pccity");t.html("");for(var n=e.data.list,a=0;n.length>a;a++)t.append('<option value="'+n[a].city_id+'">'+n[a].city_name+"</option>")}else alert(e.message)}})}function personalCenter(){$(".pCcourseList li").each(function(e,t){var n=$(t).find(".pcircle").attr("percents");n&&setTimeout(function(){n=parseInt(n,10),$(t).find(".c").attr("stroke-dasharray",parseInt(280*(n/100),10)+" 280")},400)});var e=$("#user_center_course_record").val();"true"==e&&$("#interestCourse").modal("show");var t,n,a=0;t=$("#interestCourse .modal-body li"),n=$("#interestCourse .modal-footer span"),n.click(function(){pages=parseInt((t.length-1)/6),pages>a?a++:a=0,t.hide().slice(6*a,6*(a+1)).fadeIn()}),6>=t.length&&n.unbind("click")}function zGe(){var e=window.zhuge||!1;if(e){var t="";window.otherPage&&(t="第三方访问",e.track("第三方进入该个人中心的次数",{"事件位置":document.title,"热点关键词":"第三方"})),$(".personalCmainLmenu li a").click(function(n){var a=$(n.target.parentNode).text();e.track(t+"个人中心侧边菜单点击次数",{"事件位置":"个人中心侧边菜单","热点关键词":a,"页面标题":document.title})}),$(".pCcourseList li .describe .pbtn").click(function(){"继续学习"==$(this)&&e.track("已报名课程中点击继续学习的点击数",{"事件位置":"已报名课程","热点关键词":"继续学习"})}),$(".personalCenterStasteList li .font .pcbtnP > a").click(function(){e.track("体验课程中点击的点击数",{"事件位置":"体验课程","热点关键词":$(this).text()})}),$(".teacherCenterList li > a").click(function(){e.track("老师个人中心小课程的次数",{"事件位置":"老师个人中心","热点关键词":$(this).find(".font").children(".bold").text()})}),$(".teacherCenterENDbox > .a").click(function(){e.track("已毕业中点击班级历史数据的次数",{"事件位置":"老师已毕业班级","热点关键词":"班级历史数据"})}),$(".eCother .personalCbtn").click(function(){e.track("第三方点击查看职业课程的次数",{"事件位置":"教务面板","热点关键词":"去看看麦子职业课程"})})}}var th,xsize=120,ysize=120,boundx,boundy,wScale,hScale,captchaPhone,PhoneValue,globlaImg;(function(e){e.fn.statisticsRadio=function(){if(0==this.length)return this;if(this.length>1)return this.each(function(){e(this).statisticsRadio()}),this;var t=this;t.children("input").click(function(){e("input[name='"+this.name+"']").each(function(t,n){n.checked?e(this).parent().addClass("rH"):e(this).parent().removeClass("rH")})})}})(jQuery);var setInObj,setIn_num=60,init=function(){function e(){$(".pcsBasicTable .bir").val($("#year1").val()+"-"+$("#month2").val()+"-"+$("#day3").val())}var t=$(".zy_close");$("#cuttPicture"),$(".pcsRadio").statisticsRadio(),$(".personalCTop .font .personalCico").hover(function(){layer.tips($(this).attr("title"),$(this),{tips:[1,"#333333"]})},function(){}),$(".cuttPictureBoxL .pb > a.a2").click(function(){$("#cuttPictureFile").trigger("click")}),$(".cuttPictureBoxL .pb > a.a1").click(function(){var e=$(".cuttPictureBoxL .picY"),t=e.width()>250?250:e.width(),n=e.height()>250?250:e.height();upImg.call(this,e.attr("src"),t,n,$("#w").val(),$("#h").val(),$("#x").val(),$("#y").val())}),$(".pcsBasicTableOne .imgSelect").click(change_photo0),$(".pcsBasicTable .pcprovince").change(selectCity);var n;$("#cuttPictureFile").fileupload({url:"/home/settings/avatar/upload/",dataType:"json",autoUpload:!0,done:function(e,t){if(t=t.result,t.success){var a=t.data.img_url;globlaImg=a,getImageWidth(a,function(e,t){$(".cuttPictureBoxR img").attr("src",a);var s=$("<img/>").addClass("picY");s.attr("src",a).attr("id","cuttPictureImg"),$(".cuttPictureBoxR img").removeAttr("style"),$(".cuttPictureBoxL .img").html(s),$("#cuttPictureImg").Jcrop({onChange:updatePreview,onSelect:updateCoords,aspectRatio:1},function(){n=this,n.animateTo([0,0,100,100]);var a=this.getBounds();boundx=a[0],boundy=a[1],wScale=e,hScale=t})})}else alert(t.message)}}),t.on({click:function(){$(this).parent().parent().parent().parent().parent().modal("hide")}});var a=$("#pcBasicForm").Validform({btnSubmit:".personalCbtn",ajaxPost:!0,datatype:{carded:function(e){if("True"!=is_join_job_class&&""==e)return!0;var t=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;return t.test(e)===!1?"身份证输入不合法":!0}},tiptype:function(e,t){var n="error";"radio"==t.obj.attr("type")?(t.obj.parent().parent().find(".error").remove(),t.obj.parent().parent().parent().removeClass("er"),2!=t.type&&(t.obj.parent().parent().parent().addClass("er"),t.obj.parent().parent().append("<span class='"+n+"'>"+e+"</span>"))):"hidden"==t.obj.attr("type")?(t.obj.parent().parent().removeClass("er"),t.obj.parent().find(".error").remove(),2!=t.type&&(t.obj.parent().parent().addClass("er"),t.obj.parent().append("<span class='"+n+"'>请绑定手机</span>"))):"text"==t.obj.attr("type")?(t.obj.removeClass("er"),t.obj.parent().find(".error").remove(),2!=t.type&&(t.obj.addClass("er"),t.obj.parent().append("<span class='validform "+n+"'>"+e+"</span>"))):(t.obj.removeClass("er"),t.obj.parent().find(".error").remove(),2!=t.type&&(t.obj.addClass("er"),t.obj.parent().append("<span class='validform "+n+"'>"+e+"</span>")))},beforeCheck:function(){},beforeSubmit:function(){},callback:function(e){e.success?location.href=""==e.next?location.href:e.next:layer.tips(e.message,$("#pcBasicForm .personalCbtn"),{tips:[2,"#e95050"]})}});a.resetForm();var s=time||"1990-01-01";new GySetDate({targets:"#year1,#month2,#day3",range:"1900-01-01,2030-09-21",value:s}),e(),$(".pcsBasicTable .birTD select").change(e),$("#newMeg .cl").click(function(){$("#newMeg").modal("hide")}),$(".pcsBasicTable td.ph a").click(function(){$(this).hasClass("addphone")?$("#newPhone .pt span").html("新增手机号"):$("#newPhone .pt span").html("修改手机号"),$(".captchaMy").children().remove(),captcha(".captchaMy","verifyMobile/",function(e){captchaPhone=e}),$("#newPhone").modal("show")}),$("#newPhone .personalCbtn").click(function(){var e=$(this);$.when(sendsms(e)).then(function(){$("#newPhone2 .pm").slideUp();var e=$("#newPhone2 .fg > a");e.addClass("smsend").html("重发验证码(<span>5</span>s)"),setInObj=setInterval(_foo($("#newPhone2 .fg > a>span"),60,function(){e.html("重发验证码").removeClass("smsend"),e.unbind().click(onceSend)}),1e3)})}),$("#newPhone2 .personalCbtn").click(function(){var e=$(this);$.ajax({type:"POST",url:"/home/settings/bind_mobile/",data:{mobile:PhoneValue,mobile_code:$("#newPhone2 .pcsBasicTableTxt").val()},dataType:"json",beforeSend:function(){e.css("pointer-events","none")},success:function(e){e.success?($(".pcsBasicTable td.ph").html(""),$(".pcsBasicTable td.ph").prepend(PhoneValue+' <span>(已验证)</span><a class="editphone">修改手机</a>'),$(".pcsBasicTable td.ph input").val(PhoneValue),$("#newMeg").modal("show"),setInObj=setInterval(_foo($("#newMeg .p2>span"),5,function(){$("#newMeg").modal("hide")}),1e3)):$("#newPhone2 .pm").html(e.message).slideDown()},complete:function(){e.css("pointer-events","auto")}})});var i=$("#user_center_course_record").val();"true"==i&&$("#interestCourse").modal("show");var o,r,c=0;o=$("#interestCourse .modal-body li"),r=$("#interestCourse .modal-footer span"),r.click(function(){pages=parseInt((o.length-1)/6),pages>c?c++:c=0,o.hide().slice(6*c,6*(c+1)).fadeIn()}),6>=o.length&&r.unbind("click"),$(".personalCenterSinfoList li .pcICO11").click(function(){$(this).parent().hide().next().show()}),$(".personalCenterSinfoList li .tableU td.sub .personalCbtn").click(function(){$(this).parent().hide().prev().show(),$(this).parent().prev().find("b").html($(this).prev().val());var e={career_course_id:$(this).attr("pid"),position:$(this).prev().val()};$(this).hasClass("a2")&&(e={career_course_id:$(this).attr("pid"),industry:$(this).prev().val()}),$.ajax({type:"POST",url:"/home/s/ajax_save_job/",data:e,dataType:"html",beforeSend:function(){},success:function(){},complete:function(){}})}),personalCenter(),zGe(),$(".personalCenterStasteList li").each(function(e,t){var n=$(t).find(".pcircle").attr("percents");n&&setTimeout(function(){n=parseInt(n,10),$(t).find(".c").attr("stroke-dasharray",parseInt(280*(n/100),10)+" 280")},400)})};init();