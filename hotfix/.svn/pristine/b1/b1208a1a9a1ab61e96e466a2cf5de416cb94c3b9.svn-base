/*! LPS4.0 2016-11-04
*/
function TimeGO(){1>=timeNum&&(clearInterval(TimeGOobj),location.href=$("#newMegPassword .personalCbtn").attr("href")),timeNum--,$("#newMegPassword .p2 .color5e").html(timeNum+"s")}function sendEmail(){$.ajax({type:"POST",url:"/home/settings/send_email_again/",dataType:"json",success:function(e){e.success?$("#newMeg").modal("show"):alert(e.message)}})}function addEmail(){var e=$(this);$.ajax({type:"POST",url:"/home/settings/bind_email/sendemail/",data:{email:$("#newEmail .pcsBasicTableTxt").val(),type:"verifyEmail",geetest_challenge:$("#newEmail .geetest_challenge").attr("value"),geetest_validate:$("#newEmail .geetest_validate").attr("value"),geetest_seccode:$("#newEmail .geetest_seccode").attr("value")},dataType:"json",beforeSend:function(){e.css("pointer-events","none")},success:function(e){e.success?$("#newMeg").modal("show"):$("#newEmail .megError").html(e.message).slideDown()},complete:function(){e.css("pointer-events","auto")}})}var TimeGOobj,timeNum=10,captchaEmail,init=function(){$(".personalCTop .font .personalCico").hover(function(){layer.tips($(this).attr("title"),$(this),{tips:[1,"#333333"]})},function(){});var e=$("#newPasswordForm").Validform({btnSubmit:".personalCbtn",ajaxPost:!0,datatype:{pw:function(e,t){var a=/^[^\s]+$/,n=t.val();return a.test(t.val())?n.length>=8&&50>=n.length?!0:"请填写8~50位的字符":"不能有空格"}},tiptype:function(e,t){var a="error";"password"==t.obj.attr("type")&&(t.obj.removeClass("er"),t.obj.parent().find(".error").remove(),2!=t.type&&(t.obj.addClass("er"),t.obj.parent().append("<span class='validform "+a+"'>"+e+"</span>")))},beforeCheck:function(){},beforeSubmit:function(){},callback:function(e){e.success?($("#newMegPassword").modal({show:!0,keyboard:!1,backdrop:"static"}),timeNum=10,TimeGOobj=setInterval(TimeGO,1e3)):$("#newPassword .megError").html(e.message).slideDown()}});e.resetForm(),$(".personalCenterSsetting_table td.t>a").click(function(){return $(this).hasClass("vEmail")?(sendEmail(),void 0):($(this).hasClass("addEmail")?$("#newEmail .pt span").html("新增邮箱"):$("#newEmail .pt span").html("修改邮箱"),$("#newEmail").modal("show"),$(".captchaMy").children().remove(),captcha(".captchaMy","verifyEmail/",function(e){captchaEmail=e}),void 0)}),$("#newMeg .cl").click(function(){$(".modal").modal("hide")}),$("#newEmail .personalCbtn").click(addEmail),$("#newMeg").on("hide.bs.modal",function(){location.reload()}),$(".zy_close").on({click:function(){$(this).parent().parent().parent().parent().parent().modal("hide")}})};init();