/*! LPS4.0 2016-11-04
*/
function is_login(){return"True"==$(".topRight").attr("login")}function ajax_add_answer(e,t){var a={problem_id:problem_id,parent_id:parent_id,answer_user_id:reply_id,answer_nick_name:replyname,comment:replycontent};$.ajax({url:t,dataType:"json",method:"POST",data:a,success:function(t){if(t.success){var a=t.data;if(e)replyhtml='<div class="item" discuss_id='+a.new_discuss_id+">"+'<a class="img" href="'+a.user_url+'" target="_blank">'+'<img src="'+a.head+'"/>'+"</a>"+'<div class="infos">'+'<div class="user">'+'<a href="'+a.user_url+'" class="font14"><strong answer_user_id='+a.user_id+">"+a.nick_name+"</strong></a>"+'<span class="replyTxt">回复<a target="_blank" href="'+replylinks+'">'+replyname+"</a></span>"+"</div>"+"<p>"+$("<div/>").text(replycontent).html()+"</p>"+'<div class="timeReply font14">'+'<span class="time">刚刚</span>'+'<span class="reply">回复</span>'+"</div>"+"</div>"+"</div>",detailAnswerUl.find(".click").parents("li").children(".infos").after(replyhtml);else{var n="<li discuss_id="+a.new_discuss_id+">"+'	<a class="img" href="'+a.user_url+'" target="_blank">'+'		<img src="'+a.head+'">'+"	</a>"+'	<div class="infos">'+'		<div class="user">'+'			<a href="'+a.user_url+'" class="font14"><strong answer_user_id='+a.user_id+">"+a.nick_name+"</strong></a>"+"		</div>"+"		<p>"+$("<div/>").text(replycontent).html()+"</p>"+'		<div class="timeReply font14">'+'			<span class="time">刚刚</span>'+'			<span class="reply">回复</span>'+"		</div>"+"	</div>"+"</li>";detailAnswerUl.prepend(n)}detailAnswerTextarea.val(""),detailAnswerUl.find(".reply").removeClass("click"),$(".discuss_count").text(parseInt($(".discuss_count").text())+1+" 回答")}else n=$("<span>"+t.message+"</span>"),$(".btnBottm").prepend(n),setTimeout(function(){$(".btnBottm span").remove()},5e3)}})}function ajax_html(){var e,t,a;e=$personalInterlocutionDetailInfo.attr("url"),t="",a=$(".personalInterlocutionDetailAnswer>ul>li:last").attr("discuss_id"),a&&(t+="?end_id="+a),$.ajax({url:e+t,dataType:"html",success:function(e){""==e?($(".load-more").text("没有更多"),$(".load-more").off("click")):detailAnswerUl.append(e)}})}$(".personalCTop .font .personalCico").hover(function(){layer.tips($(this).attr("title"),$(this),{tips:[1,"#333333"]})},function(){});var detailAnswerTextarea,detailAnswerUl,replylinks,replyname,reply_id,parent_id,problem_id,$personalInterlocutionDetailInfo=$(".personalInterlocutionDetailInfo");detailAnswerTextarea=$(".personalInterlocutionDetailAnswer .commentBody textarea"),detailAnswerUl=$(".personalInterlocutionDetailAnswer ul"),$personalInterlocutionDetailInfo.find(".infos dt").click(function(){if(!is_login())return login_popup(),!1;var e=$(this),t=e.attr("data-discuss-id");$.ajax({url:"/home/s/ajax_praise/",method:"POST",dataType:"json",data:{problem_id:t},success:function(t){if(t.success){var a=t.data.action,n=t.data.praise_count;"mark"==a?(e.html(n),e.addClass("parised")):"cancel"==a&&(e.html(n),e.removeClass("parised"))}else if(401==t.code)return login_popup("登录状态已过期！"),!1}})}),problem_id=$personalInterlocutionDetailInfo.attr("discuss_id"),parent_id=problem_id,replyname=$personalInterlocutionDetailInfo.find(".infos .user strong").html(),reply_id=$personalInterlocutionDetailInfo.find(".infos .user strong").attr("answer_user_id"),detailAnswerUl.on({click:function(){var e=$(this).parents(".infos").find(".user strong").html();detailAnswerUl.find(".reply").removeClass("click"),$(this).addClass("click"),replylinks=$(this).parents(".infos").find(".user>a").attr("href"),detailAnswerTextarea.focus().attr("placeholder","回复 "+e+"："),replyname=$(this).parent().siblings(".user").find("strong").html(),reply_id=$(this).parent().siblings(".user").find("strong").attr("answer_user_id"),parent_id=$(this).parents("li").attr("discuss_id")}},".reply"),$personalInterlocutionDetailInfo.on({click:function(){problem_id=$personalInterlocutionDetailInfo.attr("discuss_id"),parent_id=problem_id,replyname=$personalInterlocutionDetailInfo.find(".infos .user strong").html(),reply_id=$personalInterlocutionDetailInfo.find(".infos .user strong").attr("answer_user_id"),detailAnswerTextarea.focus(),detailAnswerUl.find(".reply").removeClass("click"),detailAnswerTextarea.attr("placeholder","")}},".reply");var replycontent;$(".personalInterlocutionDetailAnswer .btn").on("click",function(){replycontent=detailAnswerTextarea.val();var e,t=$(this).attr("ajaxUrl"),a=$(".btnBottm");return""==replycontent?(e=$("<span>请输入回复内容</span>"),a.prepend(e),void 0):(a.find("span").remove(),detailAnswerUl.find(".click").hasClass("click")?ajax_add_answer(!0,t):ajax_add_answer(!1,t),void 0)}),$(".load-more").on("click",function(){ajax_html()});